## 2026-02-02 - SSRF Protection for Web Push Endpoints
**Vulnerability:** The `WebSubscriptionSchema` allowed arbitrary URLs for `endpoint`, enabling Server-Side Request Forgery (SSRF) where the server could be tricked into sending requests to localhost or private IPs via the `web-push` library.
**Learning:** Simple regex checks or `startsWith` are insufficient for blocking private IPs due to false positives (e.g., `10.com`) and edge cases (IPv6 brackets `[::1]`). Using `node:net.isIP()` is crucial to accurately distinguish IP addresses from domain names before applying IP range filtering.
**Prevention:** Always parse URLs using `new URL()`, verify protocol is HTTPS, and use `net.isIP()` combined with range checks (CIDR) to block reserved/private IPs for any user-provided URL that the server interacts with.
